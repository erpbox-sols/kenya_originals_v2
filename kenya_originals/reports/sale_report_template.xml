<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<template id="report_sale_document_kenya_originals_inh" inherit_id="sale.report_saleorder_document">
		<xpath expr="//t[@t-set='address']" position="inside">
			<p t-if="doc.trading_id"><strong>Trading Name: </strong><span t-field="doc.trading_id.name"/></p>
		</xpath>
		<xpath expr="//tbody[hasclass('sale_tbody')]/t[@t-foreach='doc.order_line']/tr/t[@t-if='not line.display_type']/td[@name='td_taxes']" position="replace">
			<td name="td_taxes" class="text-right">
                <span t-esc="', '.join(map(lambda x: (x.description or x.name) , line.tax_id.filtered(lambda tax: not tax.dont_show_on_invoice)))"/>
            </td>
        </xpath>
        <xpath expr="//tbody[hasclass('sale_tbody')]/t[@t-set='current_subtotal']" position="before">
        	<t t-set="tax_value" t-value="0"/>
        </xpath>
       	<xpath expr="//tbody[hasclass('sale_tbody')]/t[@t-foreach='doc.order_line']/tr/t[@t-if='not line.display_type']/td[@name='td_subtotal']" position="replace">
       		<t t-set="tax_value" t-value="sum(line.tax_id.filtered(lambda tax: tax.dont_show_on_invoice).mapped('amount'))"/>
            <t t-set="price_subtotal" t-value="tax_value + line.price_subtotal"/>
			<td name="td_subtotal" class="text-right o_price_total">
                <span t-esc="price_subtotal"/>
            </td>
		</xpath>
		<xpath expr="//div[@name='so_total_summary']/div/div/table/tr[hasclass('o_subtotal')]/td[@name='td_amount_untaxed']" position='replace'>
			<td name="td_amount_untaxed" class="text-right">
            	<t t-set="amount_untaxed" t-value="doc.amount_untaxed + tax_value"/>
                <span t-esc="amount_untaxed"/>
            </td>
		</xpath>
		<xpath expr="//t[@t-as='amount_by_group']" position="replace">
			<t t-foreach="doc.amount_by_group" t-as="amount_by_group">
                <tr t-if="amount_by_group[0] != 'Excise Duty'" style="">
                    <t t-if="amount_by_group[5] == 1 and doc.amount_untaxed == amount_by_group[2]">
                        <td name="td_amount_by_group_label_3">
                            <span t-esc="amount_by_group[0]"/>
                            <span>&amp;nbsp;<span>on</span>&amp;nbsp;<t t-esc="amount_by_group[2]" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/></span>
                        </td>
                        <td name="td_amount_by_group_3" class="text-right o_price_total">
                            <span t-esc="amount_by_group[1]"
                                t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                        </td>
                    </t>
                    <t t-else ="">
                        <td name="td_amount_by_group_label">
                            <span t-esc="amount_by_group[0]"/>
                        </td>
                        <td name="td_amount_by_group" class="text-right o_price_total">
                            <span t-esc="amount_by_group[1]"
                                t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                        </td>
                    </t>
                </tr>
            </t>
		</xpath>
	</template>
</odoo>